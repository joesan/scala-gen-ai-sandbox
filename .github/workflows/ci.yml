name: Scala BPE App CI

on:
  push:
    branches: [main, master]
    # Ignore changes to README.md and docs folder
    paths-ignore:
      - 'README.md'
      - 'docs/**'
  pull_request:
    branches: [main, master]
    paths-ignore:
      - 'README.md'
      - 'docs/**'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      # Set up Java first
      - name: Set up JDK
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: 17

      # Set up Scala + sbt
      - name: Set up Scala and sbt
        uses: olafurpg/setup-scala@v13   # <- Use v13 or latest stable tag
        with:
          scala-version: 2.13.12
          sbt-version: 1.10.6

      # Cache sbt and Ivy dependencies
      - name: Cache sbt dependencies
        uses: actions/cache@v3
        with:
          path: |
            ~/.ivy2/cache
            ~/.sbt
            ~/.coursier
          key: sbt-${{ runner.os }}-${{ hashFiles('**/build.sbt') }}

      # Run tests
      - name: Run tests
        run: sbt test

      # Run main app
      - name: Run main app
        run: sbt "project genAITokenize" "runMain com.genai.sandbox.BPEApp"
