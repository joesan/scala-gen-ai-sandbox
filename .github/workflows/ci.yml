name: Scala BPE App CI

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      # Install Java
      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: 17

      # Install Scala + sbt
      - name: Set up Scala and sbt
        uses: olafurpg/setup-scala@v17
        with:
          scala-version: '2.13.12'
          sbt-version: '1.10.6'

      # Cache sbt and Ivy dependencies
      - name: Cache sbt dependencies
        uses: actions/cache@v3
        with:
          path: |
            ~/.ivy2/cache
            ~/.sbt
            ~/.coursier
          key: sbt-${{ runner.os }}-${{ hashFiles('**/build.sbt') }}

      # Run tests
      - name: Run tests
        run: sbt test

      # Run main app
      - name: Run main app
        run: sbt "runMain com.genai.sandbox.BPEApp"
